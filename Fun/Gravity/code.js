var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};window.Particle=function(a){this.x=a.x||0;this.y=a.y||0;this.xSpeed=a.xSpeed||0;this.ySpeed=a.ySpeed||0;this.mass=void 0===a.mass?1:a.mass;this.density=a.density||1;this.overrideRadius()};window.Particle.prototype.move=function(){this.x+=this.xSpeed;this.y+=this.ySpeed};window.Particle.prototype.getCopy=function(){return new Particle({x:this.x,y:this.y,xSpeed:this.xSpeed,ySpeed:this.ySpeed,mass:this.mass,density:this.density})};window.Particle.prototype.overrideRadius=function(){this.radius=Math.sqrt(this.mass*this.density/Math.PI)};window.Particle.prototype.join=function(a){var b=this.mass+a.mass;this.xSpeed=(this.xSpeed*this.mass+a.xSpeed*a.mass)/b;this.ySpeed=(this.ySpeed*this.mass+a.ySpeed*a.mass)/b;this.density=Math.round((Math.pow(this.radius,2)*Math.PI+Math.pow(a.radius,2)*Math.PI)/b*1E3)/1E3;this.mass=b;this.mass<a.mass&&(b=this.mass/a.mass,this.x+=(this.x-a.x)*b,this.y+=(this.y-a.y)*b);this.overrideRadius()};window.onresize=overrideCanvasSize;var mouse={x:null,y:null,xWorld:null,yWorld:null,distance:null,mousedown:!1,mousemoved:!1},wheel=function(a){a=a||window.event;if(a.wheelDelta){var b=a.wheelDelta;window.opera&&(b=-b)}else a.detail&&(b=-a.detail);0<b?userDisplay.zoom*=2:0>b&&(userDisplay.zoom/=2);userDisplay.overrideCoords()},mousemoveListener=function(a){mouse.mousemoved=!0;userDisplay.bodyToFollow=null;mouse.distance+=abs(mouse.x-a.clientX)+abs(mouse.y-a.clientY);userDisplay.x+=(mouse.x-a.clientX)/userDisplay.zoom;userDisplay.y+=(mouse.y-a.clientY)/userDisplay.zoom;userDisplay.overrideCoords();mouse.x=a.clientX;mouse.y=a.clientY},removeListeners=function(){mouse.mousedown=!1;mouse.mousemoved=!1;mouse.distance=null;window.removeEventListener("mousemove",mousemoveListener)};window.onmousedown=function(a){mouse.distance=null;mouse.mousedown=!0;mouse.x=a.clientX;mouse.y=a.clientY;window.addEventListener("mousemove",mousemoveListener)};window.onblur=removeListeners;window.onmouseup=function(a){if(mouse.mousedown&&3>=mouse.distance){var b;a=$jscomp.makeIterator(particles);for(b=a.next();!b.done;b=a.next()){var d=b.value;b=Math.sqrt(Math.pow(mouse.xWorld-d.x,2)+Math.pow(mouse.yWorld-d.y,2));if(b<=d.radius+userOptions.selectBodyRadius/userDisplay.zoom){userDisplay.bodyToFollow=d;break}}}removeListeners()};window.addEventListener?window.addEventListener("mousewheel",wheel,!1):window.attachEvent&&window.attachEvent("onmousewheel",wheel);Number.prototype.between=function(a,b){return this>=a&&this<=b};var keys=[];window.onkeydown=function(a){a=a.keyCode;!keys.includes(a)&&keys.push(a);switch(a){case 32:world.work=!world.work;break;case 70:userDisplay.followBigger();break;case 82:world.reset();break;case 219:if(1>=userOptions.simulationSpeed)break;userOptions.simulationSpeed>>>=1;displaySimulationSpeed(userOptions.simulationSpeed);break;case 221:userOptions.simulationSpeed<<=1;displaySimulationSpeed(userOptions.simulationSpeed);break;default:console.log(a)}};window.onkeyup=function(a){a=keys.indexOf(a.keyCode);-1!==a&&keys.splice(a,1)};var world={G:5,work:!0,initOptions:{count:200,area:{xStart:-1E3,yStart:-1E3,width:2E3,height:2E3},minMass:1,maxMass:30,maxVelocity:5,minVelocity:.25},reset:function(){particles=[];this.init(this.initOptions);userDisplay.x=0;userDisplay.y=0;userDisplay.overrideCoords()},init:function(a){a=void 0===a?{}:a;void 0===a.count&&(a.count=50);void 0===a.minVelocity&&(a.minVelocity=0);void 0===a.maxVelocity&&(a.maxVelocity=0);void 0===a.minMass&&(a.minMass=1);void 0===a.maxMass&&(a.maxMass=1);void 0===a.minDensity&&(a.minDensity=1);void 0===a.maxDensity&&(a.maxDensity=1);a.area.xEnd=a.area.xStart+a.area.width;a.area.yEnd=a.area.yStart+a.area.height;particlesCtx.clearRect(0,0,w,h);coverCtx.clearRect(0,0,w,h);for(var b=0,d;b!==a.count;b++){d=randFloat(a.minVelocity,a.maxVelocity);var c=(.5<Math.random()?-1:1)*randFloat(0,d);d=[c,(.5<Math.random()?-1:1)*(d-c)];particles.push(new Particle({x:rand(a.area.xStart,a.area.xEnd),y:rand(a.area.yStart,a.area.yEnd),xSpeed:d[0],ySpeed:d[1],mass:rand(a.minMass,a.maxMass),density:rand(a.minDensity,a.maxDensity)}))}}},userDisplay={xStart:null,yStart:null,xEnd:null,yEnd:null,x:0,y:0,particlesInRange:[],followBigger:function(){if(0!==particles.length){for(var a=particles[0],b=0;b!==particles.length;b++)particles[b].mass>a.mass&&(a=particles[b]);this.bodyToFollow=a;this.follow(a)}},up:function(a){a=void 0===a?userOptions.movingSpeed:a;this.y-=a/this.zoom;this.overrideCoords()},down:function(a){a=void 0===a?userOptions.movingSpeed:a;this.y+=a/this.zoom;this.overrideCoords()},left:function(a){a=void 0===a?userOptions.movingSpeed:a;this.x-=a/this.zoom;this.overrideCoords()},right:function(a){a=void 0===a?userOptions.movingSpeed:a;this.x+=a/this.zoom;this.overrideCoords()},update:function(){this.bodyToFollow&&this.follow();this.clear();this.overrideRange();this.drawParticles();this.drawSpeed()},zoom:1,clear:function(){0!==this.particlesInRange.length&&(particlesCtx.clearRect(0,0,w,h),coverCtx.clearRect(0,0,w,h))},bodyToFollow:null,follow:function(a){a=void 0===a?this.bodyToFollow:a;this.x=~~a.x;this.y=~~a.y;this.overrideCoords()},drawParticles:function(){if(0!==this.particlesInRange.length)for(var a=0,b=2*this.zoom;a!==this.particlesInRange.length;a++)particlesCtx.fillStyle=particlesCtx.strokeStyle="rgb(0,"+240/this.particlesInRange[a].density+",40)",particlesCtx.beginPath(),particlesCtx.arc(~~((this.particlesInRange[a].x-this.xStart)*this.zoom),~~((this.particlesInRange[a].y-this.yStart)*this.zoom),floor(this.particlesInRange[a].radius*b)/2,0,PI2),particlesCtx.fill(),particlesCtx.stroke()},drawSpeed:function(a,b){b=void 0===b?10:b;if(0!==this.particlesInRange.length){coverCtx.strokeStyle=void 0===a?"red":a;var d=[],c;for(c=0;c!==this.particlesInRange.length;c++)d.includes(this.particlesInRange[c].radius)||d.push(this.particlesInRange[c].radius);d=$jscomp.makeIterator(d);for(c=d.next();!c.done;c=d.next()){var g=c.value;coverCtx.beginPath();coverCtx.lineWidth=g/2*this.zoom;for(c=0;c!==this.particlesInRange.length;c++)this.particlesInRange[c].radius===g&&(coverCtx.moveTo(~~((this.particlesInRange[c].x-this.xStart)*this.zoom),~~((this.particlesInRange[c].y-this.yStart)*this.zoom)),coverCtx.lineTo(~~((this.particlesInRange[c].x-this.xStart+this.particlesInRange[c].xSpeed*b)*this.zoom),~~((this.particlesInRange[c].y-this.yStart+this.particlesInRange[c].ySpeed*b)*this.zoom)));coverCtx.stroke()}}},overrideRange:function(){this.particlesInRange=[];for(i=0;i!==particles.length;i++)particles[i].x.between(this.xStart-particles[i].radius,this.xEnd+particles[i].radius)&&particles[i].y.between(this.yStart-particles[i].radius,this.yEnd+particles[i].radius)&&this.particlesInRange.push(particles[i])},overrideCoords:function(){this.xStart=this.x-w/2/this.zoom;this.yStart=this.y-h/2/this.zoom;this.xEnd=this.xStart+w/this.zoom;this.yEnd=this.yStart+h/this.zoom}},userOptions={movingSpeed:15,selectBodyRadius:15,simulationSpeed:1},particlesCanvas=$("particlesCanvas"),coverCanvas=$("coverCanvas"),particlesCtx=particlesCanvas.getContext("2d"),coverCtx=coverCanvas.getContext("2d"),w,h,partColor=[0,200,40],particles=[],bufferParticles=[],PI2=2*Math.PI,panel=document.createElement("div");panel.style="position:fixed; top:0; left:0;";panel.setAttribute("class","display");var div=document.createElement("div"),span=document.createElement("span");div.innerText="Simulation speed : ";span.innerText=1;div.appendChild(span);panel.appendChild(div);window.displaySimulationSpeed=function(a){span.innerText=a};var div$6=document.createElement("div"),span$7=document.createElement("span");div$6.innerText="Total kinetic energy ";div$6.appendChild(span$7);panel.appendChild(div$6);window.displayTotalSpeed=function(){for(var a=0,b=0;b!==particles.length;b++)a+=particles[b].mass*Math.pow(particles[b].xSpeed+particles[b].ySpeed,2);span$7.innerText=~~(a/2)};setInterval(displayTotalSpeed,50);var div$9=document.createElement("div"),span$10=document.createElement("span");div$9.innerText="Bodies ";div$9.appendChild(span$10);panel.appendChild(div$9);window.displayBodies=function(a){span$10.innerText=a};document.body.appendChild(panel);var div$11=document.createElement("div");div$11.setAttribute("class","display");div$11.style="position:fixed; bottom:0px; left:0px;";div$11.innerText="x : null\ny : null";window.addEventListener("mousemove",function(a){return div$11.innerText="x : "+(mouse.xWorld=~~(userDisplay.xStart+a.clientX/userDisplay.zoom))+"\ny : "+(mouse.yWorld=~~(userDisplay.yStart+a.clientY/userDisplay.zoom))});document.body.appendChild(div$11);antialiasing(coverCtx,!1);antialiasing(particlesCtx,!1);overrideCanvasSize();userDisplay.overrideCoords();world.reset();displayBodies(particles.length);listener();function calculate(){for(var a,b,d,c,g,k=[],f=0,e;f!==particles.length;f++)if(a=particles[f],!k.includes(f))for(e=f+1;e!==particles.length;e++)k.includes(e)||(b=particles[e],c=b.x-a.x,g=b.y-a.y,d=Math.pow(c,2)+Math.pow(g,2),d<=Math.pow(a.radius+b.radius,2)?(particles[f].join(particles[e]),k.push(e),userDisplay.bodyToFollow===b&&(userDisplay.bodyToFollow=a),displayBodies(particles.length-k.length)):(d=world.G/d/(abs(c)+abs(g)),c*=d,g*=d,particles[f].xSpeed+=c*b.mass,particles[e].xSpeed-=c*a.mass,particles[f].ySpeed+=g*b.mass,particles[e].ySpeed-=g*a.mass));if(k.length)for(a=0;a!==k.length;a++)particles.splice(k[a]-a,1)}function overrideCanvasSize(){particlesCanvas.width=coverCanvas.width=w=window.innerWidth;particlesCanvas.height=coverCanvas.height=h=window.innerHeight}function move(){for(var a=0,b=particles.length;a!==b;a++)particles[a].move()}function listener(){if(keys.length)for(var a=$jscomp.makeIterator(keys),b=a.next();!b.done;b=a.next())key=b.value,37===key?userDisplay.left():39===key&&userDisplay.right(),38===key?userDisplay.up():40===key&&userDisplay.down();if(world.work)for(a=0;a!==userOptions.simulationSpeed;a++)move(),calculate();userDisplay.update();window.requestAnimationFrame(listener)}function stop(){listener=function(){}}function rand(a,b){return Math.round(a-.5+Math.random()*(b-a+1))}function floor(a){return~~a===a?a:a+1}function randFloat(a,b){return a+Math.random()*(b-a)}function $(a){return document.getElementById(a)}function antialiasing(a,b){a.mozImageSmoothingEnabled=a.webkitImageSmoothingEnabled=a.msImageSmoothingEnabled=a.imageSmoothingEnabled=b}function abs(a){return 0<a?a:-a};