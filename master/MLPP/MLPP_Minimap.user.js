// ==UserScript==
// @name         MLP Pixel Minimap
// @version      2.2.1
// @description  My Little Pony Pixel (MLP Pixel) Minimap for PixelZone.io
// @author       Endless Night
// @include      *://pixelzone.io/*
// @homepage     https://github.com/EndlessNightNLR/endlessnightnlr.github.io
// @updateURL    https://endlessnightnlr.github.io/master/MLPP/MLPP_Minimap.user.js
// @downloadURL  https://endlessnightnlr.github.io/master/MLPP/MLPP_Minimap.user.js
// @grant        none
// ==/UserScript==
//
// To the glory of Luna and the New Lunar Republic!
//
var $jscomp=$jscomp||{};$jscomp['scope']={};$jscomp['arrayIteratorImpl']=function(c){var d=0x0;return function(){return d<c['length']?{'done':!0x1,'value':c[d++]}:{'done':!0x0};};};$jscomp['arrayIterator']=function(e){return{'next':$jscomp['arrayIteratorImpl'](e)};};$jscomp['makeIterator']=function(f){var g='undefined'!=typeof Symbol&&Symbol['iterator']&&f[Symbol['iterator']];return g?g['call'](f):$jscomp['arrayIterator'](f);};setTimeout(function(){function h(){aJ&&al('Updating\x20Template\x20List');var i=new XMLHttpRequest(),j=void 0x0;j='own'==aO[aP]['templates']?0x2==aO[aP]['type']?aO[aP]['url']+'templates/data.json':aO[aP]['url']+'templates/data.json?'+new Date()['getTime']():'New\x20Lunar\x20Republic'==aP?aO['New\x20Lunar\x20Republic']['url']+'templates/data.json':aO['New\x20Lunar\x20Republic']['url']+'templates/'+aP+'.json';i['onreadystatechange']=function(){if(0x4==this['readyState']&&0xc8==this['status']){aU=JSON['parse'](this['responseText']);aV=[];aW=[];for(var k in aU)aU[k]['x']*=0x1,aU[k]['y']*=0x1,aU[k]['width']*=0x1,aU[k]['height']*=0x1,'grid'===aU[k]['type']?aW[k]={'x':aU[k]['x'],'y':aU[k]['y'],'width':aU[k]['width'],'height':aU[k]['height']}:aV[k]={'x':aU[k]['x'],'y':aU[k]['y'],'width':aU[k]['width'],'height':aU[k]['height']};var i=$jscomp['makeIterator'](b1['templates']);for(k=i['next']();!k['done'];k=i['next']())r(k['value'],function(){return al('Img\x20updated');});i=$jscomp['makeIterator'](b1['grids']);for(k=i['next']();!k['done'];k=i['next']())r(k['value'],function(){return al('Grid\x20updated');});aJ&&console['log']('Update\x20completed',aU,aV,aW);}};i['open']('GET',j,!0x0);i['send']();}function m(){aY&&!b6&&(b7&&(b7=!0x1,aI=aH,localStorage['sync']=b7,aj('sync')['innerText']=b7?'On':'Off',C()),aI*=1.1,0x20<aI?aI=0x20:(b6?bo['override']():b7?ar(aH):ar(),af(),a8(),ba(),setTimeout(m,0x32)));}function n(){aZ&&!b6&&(b7&&(b7=!0x1,aI=aH,localStorage['sync']=b7,aj('sync')['innerText']=b7?'On':'Off',C()),aI/=1.1,0x1>aI?aI=0x1:(b6?bo['override']():b7?ar(aH):ar(),af(),a8(),o(),setTimeout(n,0x32)));}function o(){if(aX&&aV){b1['grids']=[];b1['templates']=[];for(var p in aV)aS['between'](aV[p]['x']-0x32,aV[p]['x']+aV[p]['width']+0x32)&&aT['between'](aV[p]['y']-0x32,aV[p]['y']+aV[p]['height']+0x32)&&(b0[p]?b1['templates']['push'](p):r(p));if(b4)for(var q in aW)aS['between'](aW[q]['x']-0x32,aW[q]['x']+aW[q]['width']+0x32)&&aT['between'](aW[q]['y']-0x32,aW[q]['y']+aW[q]['height']+0x32)&&(b0[q]?b1['grids']['push'](q):r(q));0x0===b1['grids']['length']&&0x0===b1['templates']['length']?aY||aZ||(aj('minimap-box')['style']['display']='none',aj('minimap-text')['style']['display']='block',aj('minimap-text')['innerText']='There\x27s\x20nothing\x20here.'):(aj('minimap-box')['style']['display']='block',aj('minimap-text')['style']['display']='none',bb&&(bb=!0x1,window['requestAnimationFrame'](function(){ba();bb=!0x0;})));}}function r(s,t){aJ&&al('Load\x20'+(aW[s]?'grid':'image')+'\x20:\x20'+s);var u=new Image();b0[s]||(b0[s]=u);u['crossOrigin']='';u['src']=aO[aP]['url']+'images/'+s+'.png';u['addEventListener']('load',function(){if(!(0x300>=u['width']&&0x300>=u['height'])){for(var v=0x0;0x100<u['height']-v;v+=0x200)for(var t=0x0;0x100<u['width']-t;t+=0x200){var x=s+'_'+(v>>>0x9)+'_'+(t>>>0x9);aU[x]={'x':aU[s]['x']+t,'y':aU[s]['y']+v,'width':0x200<=u['width']-t?0x200:u['width']-t,'height':0x200<=u['height']-v?0x200:u['height']-v};'grid'===aU[s]['type']?aW[x]=aU[x]:aV[x]=aU[x];b0[x]=document['createElement']('canvas');b0[x]['width']=aU[x]['width'];b0[x]['height']=aU[x]['height'];var y=b0[x]['getContext']('2d');y['drawImage'](u,t,v,aU[x]['width'],aU[x]['height'],0x0,0x0,aU[x]['width'],aU[x]['height']);y=y['getImageData'](0x0,0x0,aU[x]['width'],aU[x]['height'])['data'];for(var z=!0x0,A=0x3,B=y['length'];A<=B;A+=0x4)if(0x0!==y[A]){z=!0x1;break;}z&&(delete b0[x],'grid'===aU[s]['type']?delete aW[x]:delete aV[x],delete aU[x]);}'grid'===aU[s]['type']?delete aW[s]:delete aV[s];delete aU[s];delete b0[s];console['log'](aU);}});0x1<arguments&&u['addEventListener']('load',t);}function C(){ba=b6?b4?function(){H(aH);a1(aH);}:function(){return H(aH);}:b7?b4?function(){D(aH);a1(aH);}:function(){return D(aH);}:b4?function(){D();a1();}:D;}function D(E){E=void 0x0===E?aI:E;bi['clearRect'](0x0,0x0,be['width'],be['height']);for(var F=$jscomp['makeIterator'](b1['templates']),G=F['next']();!G['done'];G=F['next']())G=G['value'],bi['drawImage'](b0[G],(aV[G]['x']-aK)*E,(aV[G]['y']-aL)*E,b0[G]['width']*E,b0[G]['height']*E);}function H(h){h=void 0x0===h?aH:h;bi['clearRect'](0x0,0x0,be['width'],be['height']);for(var J=document['createElement']('canvas'),K=J['getContext']('2d'),L,M=0x0,N=bo['width']<<0x2,O=Math['pow'](h,0x2);0x1<O;O>>>=0x1)M++;L=M>>>0x1;J['width']=bo['width'];J['height']=bo['height'];O=$jscomp['makeIterator'](b1['templates']);for(var P=O['next']();!P['done'];P=O['next']())P=P['value'],K['drawImage'](b0[P],bo['xLeft']-aV[P]['x']-0x1,bo['yTop']-aV[P]['y']-0x1,bo['width'],bo['height'],0x0,0x0,bo['width'],bo['height']);O=K['getImageData'](0x0,0x0,J['width'],J['height']);P=O['data'];L=aQ['getContext']('2d')['getImageData'](aM-(bo['width']<<L>>>0x1),aN-(bo['height']<<L>>>0x1),bo['width']*h,bo['height']*h)['data'];for(var Q=0x0,R=0x0,S=bo['height']*N;Q<S;Q+=N,R=Q<<M)for(var T=Q,U=Q+(bo['width']<<0x2);T<U;T+=0x4,R+=aH<<0x2)if(0x0!=L[R+0x3]){var V=P[T],W=P[T+0x1],X=P[T+0x2],Y=L[R],Z=L[R+0x1],a0=L[R+0x2];0x28>(V>Y?V-Y:Y-V)+(W>Z?W-Z:Z-W)+(X>a0?X-a0:a0-X)?P[T]=P[T+0x1]=P[T+0x2]=(P[T]+P[T+0x1]+P[T+0x2])/0x3:(P[T]=0xff,P[T+0x1]=0x0,P[T+0x2]=0x0);}K['putImageData'](O,0x0,0x0);bi['drawImage'](J,bo['borderW']-h,bo['borderH']-h,bo['width']*h,bo['height']*h);}function a1(a2){a2=void 0x0===a2?aI:a2;bj['clearRect'](0x0,0x0,bf['width'],bf['height']);if(b6){var a3=(bo['xLeft']-aS)/aG+aS;var a4=(bo['yTop']-aT)/aG+aT;}else a3=(aK-aS)/aG+aS,a4=(aL-aT)/aG+aT;for(var a5=$jscomp['makeIterator'](b1['grids']),a6=a5['next']();!a6['done'];a6=a5['next']()){a6=a6['value'];var a7=a2*aG;bj['drawImage'](b0[a6],(aW[a6]['x']-a3)*a7,(aW[a6]['y']-a4)*a7,b0[a6]['width']*a7,b0[a6]['height']*a7);}}function a8(a9){a9=void 0x0===a9?aI:a9;if(b3){if(b6||b7)a9=aH;bk['clearRect'](0x0,0x0,bg['width'],bg['height']);if(!(4.6>=a9)){bk['beginPath']();for(var aa=bg['width']+a9,ab=bg['height']+a9,ac=(be['width']>>>0x1)%a9-a9,ad=(be['height']>>>0x1)%a9-a9,ae=0x0;ae<=aa;ae+=a9)bk['moveTo'](ae+ac,ad),bk['lineTo'](ae+ac,ab+ad);for(ae=0x0;ae<=ab;ae+=a9)bk['moveTo'](ac,ae+ad),bk['lineTo'](aa+ac,ae+ad);bk['strokeStyle']='black';bk['stroke']();}}}function af(ag){ag=void 0x0===ag?aI:ag;if(b6||b7)ag=aH;bl['clearRect'](0x0,0x0,bh['width'],bh['height']);bl['beginPath']();bl['lineWidth']=ag/0x3;bl['strokeStyle']=b2;bl['rect'](be['width']>>>0x1,be['height']>>>0x1,ag,ag);bl['stroke']();}function ah(ai){ai=document['getElementById'](ai);ai['style']['display']='none'==ai['style']['display']?'block':'none';}function aj(aj){return document['getElementById'](aj);}function al(){for(var aj=$jscomp['makeIterator'](arguments),an=aj['next']();!an['done'];an=aj['next']())console['log'](an['value']);}function ao(aj){aj=aj||window['event'];if(aj['wheelDelta']){var aq=aj['wheelDelta']/0x78;window['opera']&&(aq=~aq+0x1);}else aj['detail']&&(aq=-aj['detail']/0x3);0x1==aq?aH<<=0x1:aH>>>=0x1;0x40<aH?aH=0x40:0x1>aH?aH=0x1:b7&&!b6?(ar(aH),a8(),af(),o()):b6&&(ar(aH),setTimeout(function(){bo['override']();H();},0xc8),a8(aH),af(aH),b4&&a1());}function ar(aj){aj=void 0x0===aj?aI:aj;aK=aS-(be['width']>>>0x1)/aj;aL=aT-(be['height']>>>0x1)/aj;}(function ea(){aj('timer')?aj('timer')['style']['z-index']=0x5:setTimeout(ea,0x14d);}());(function d(){aj('message')?aj('message')['remove']():setTimeout(d,0x14d);}());var at=document['createElement']('link');at['rel']='stylesheet';at['href']='https://endlessnightnlr.github.io/master/MLPP/style.css';document['head']['appendChild'](at);at=document['createElement']('div');at['style']='position:\x20absolute;\x20left:\x200px;\x20top:\x2057px;\x20margin:\x20-2px\x200px\x200px\x20-2px;';at['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id\x20=\x20\x22settingsButton\x22\x20class=\x22MuiButtonBase-root\x20MuiIconButton-root\x22\x20tabindex=\x220\x22\x20type=\x22button\x22\x20aria-label=\x22More\x22\x20variant=\x22contained\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22MuiIconButton-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tr-bg\x22\x20style=\x22width:\x2025px;\x20height:\x2025px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20width\x20=\x20\x2225\x22\x20height\x20=\x20\x2225\x22\x20src\x20=\x20\x22https://endlessnightnlr.github.io/master/MLPP/gear.png\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</img>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22MuiTouchRipple-root\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20';document['body']['appendChild'](at);aj('settingsButton')['onclick']=function(){ah('settingsDiv');'block'==aj('settingsDiv')['style']['display']&&(aj('settingsDiv')['style']['left']=(window['innerWidth']-aj('settingsDiv')['offsetWidth']>>>0x1)+'px',aj('settingsDiv')['style']['top']=(window['innerHeight']-aj('settingsDiv')['offsetHeight']>>>0x1)+'px');};Number['prototype']['between']=function(aj,av){return this>aj&&this<av;};var aw='black\x20gray\x20white\x20Fuchsia\x20red\x20yellow\x20lime\x20springGreen\x20aqua\x20blue'['split']('\x20'),ax='New',ay={'Old':'background-color:\x20rgba(0,\x200,\x200,\x200.75);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20height:\x20auto;\x20border-radius:\x2021px;\x20padding:\x206px;','New':'background-color:\x20rgba(0,\x200,\x200,\x200.90);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20height:\x20auto;\x20border-radius:\x201px;\x20padding:\x201px;\x20padding-left:\x205px;'},az={'Old':'position:\x20absolute;\x20right:\x200.5em;\x20bottom:\x204.75em;\x20background-color:\x20rgba(0,\x200,\x200,\x200.75);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20width:\x20auto;\x20height:\x20auto;\x20border-radius:10px;\x20padding:\x206px;','New':'position:\x20absolute;\x20right:\x200em;\x20top:\x200em;\x20background-color:\x20rgba(0,\x200,\x200,\x200.90);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20width:\x20auto;\x20height:\x20auto;\x20border-radius:\x201px;\x20padding:\x201px;\x20padding-left:\x201px;'},aA={'Old':0x1a4,'New':0x118},aB={'Old':0x12c,'New':0xc8},aC={'false':0x1,'true':0.5},aD={'ru':{'width':'280px','title':{'filling':'MLP\x20Pixel\x20миникарта:\x20настройки'},'cursorColor':{'filling':'Цвет\x20курсора:\x20','true':'On','false':'Off'},'grid':{'filling':'Сетка:\x20','true':'On','false':'Off'},'mapStyle':{'filling':'Стиль\x20миникарты:\x20','New':'New','Old':'Old'},'sectors':{'filling':'Сектора:\x20','true':'On','false':'Off'},'sectorShift':{'filling':'Сдвиг\x20секторов:\x20','true':'On','false':'Off'},'translucent':{'filling':'Прозрачность\x20секторов:\x20','true':'On','false':'Off'},'detector':{'filling':'Детектор\x20ошибок:\x20','true':'On','false':'Off'},'language':{'filling':'Язык:\x20'},'sync':{'filling':'Синхронизация\x20зума:\x20'}},'en':{'width':'250px','title':{'filling':'MLP\x20Pixel\x20minimap:\x20settings'},'cursorColor':{'filling':'Cursor\x20color:\x20','true':'On','Off':'Off'},'grid':{'filling':'Grid:\x20','true':'On','Off':'Off'},'mapStyle':{'filling':'Minimap\x20style:\x20','New':'New','Old':'Old'},'sectors':{'filling':'Sectors:\x20','true':'On','false':'Off'},'sectorShift':{'filling':'Sectors\x20shift:\x20','true':'On','false':'Off'},'translucent':{'filling':'Translucent:\x20','true':'On','false':'Off'},'detector':{'filling':'Error\x20detector:\x20','true':'On','false':'Off'},'language':{'filling':'Language:\x20'},'sync':{'filling':'Zoom\x20sync:\x20'}}},aE=!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i['test'](navigator['userAgent']),aF='Off',aG=0x1,aH=0x1,aI=0x5,aJ=!0x1,aK=void 0x0,aL=void 0x0,aM=void 0x0,aN=void 0x0,aO={'New Lunar Republic':{'url':'https://endlessnightnlr.github.io/master/','color':'aqua','type':'2'}},aP=Object['keys'](aO)[0x0],aQ=aj('canvas'),aR=aj('coordinatesNote'),aS=0x0,aT=0x0,aU,aV=[],aW=[],aX=!0x0,aY=!0x1,aZ=!0x1,b0=[],b1={'grids':[],'templates':[]},b2='springGreen',b3=!0x1,b4=!0x1,b5=!0x1,b6=!0x1,b7=!0x1,b8=(window['navigator']['language']||window['navigator']['systemLanguage']||window['navigator']['userLanguage'])['substr'](0x0,0x2)['toLowerCase'](),b9=new RegExp(/-?\d+/g),ba,bb=!0x0;aH=window['location']['href']['match'](b9)&&0x3==window['location']['href']['match'](b9)['length']?+window['location']['href']['match'](b9)[0x2]:0x1;aQ['addEventListener']?aQ['addEventListener']('mousewheel',ao,!0x1):aQ['attachEvent']&&aQ['attachEvent']('onmousewheel',ao);/Firefox/i['test'](navigator['userAgent'])&&window['addEventListener']('DOMMouseScroll',function(aj){0x3==aj['wheelDelta']?aH<<=0x1:aH>>>=0x1;0x40<aH?aH=0x40:0x1>aH?aH=0x1:b7&&!b6?(ar(aH),a8(),af(),o()):b6&&(ar(aH),setTimeout(function(){bo['override']();H();},0xc8),a8(aH),af(aH),b4&&a1());});localStorage['cursorColor']?b2=localStorage['cursorColor']:localStorage['cursorColor']=b2;'true'==localStorage['debug']&&(aJ=!0x0);'true'==localStorage['grid']&&(b3=!0x0);'Old'==localStorage['mapStyle']&&(ax='Old');'true'==localStorage['sectors']&&(b4=!0x0);'true'==localStorage['sectorShift']&&(aF=!0x0,aG=0.8);'true'==localStorage['translucent']&&(b5=!0x0);localStorage['mobile']&&(aE=localStorage['mobile']);'true'==localStorage['detector']&&(b6=aE?localStorage['detector']=!0x1:!0x0);'true'==localStorage['sync']&&(b7=!0x0);localStorage['zoomlevel']&&(aI=+localStorage['zoomlevel']);localStorage['language']&&(b8=localStorage['language']);C();al('MLPP\x20MINIMAP\x20VERSION\x20:\x202.2.3');for(var bd in aO);bd=document['createElement']('div');bd['id']='minimapbg';bd['style']=az[ax];bd['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22minimap-text\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22minimap-box\x22\x20style=\x22position:\x20relative;width:'+aA[ax]+'px;height:'+aB[ax]+'px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22minimap\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;z-index:1;position:absolute;top:0;left:0;\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22minimapCover\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;z-index:2;position:absolute;top:0;left:0;opacity:'+aC[b5]+';\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22minimap-board\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;z-index:3;position:absolute;top:0;left:0;\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22minimap-cursor\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;z-index:4;position:absolute;top:0;left:0;\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22minimap-config\x22\x20style=\x22line-height:15px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22hide-MAP\x22\x20style=\x22cursor:pointer;font-weight:bold;color:\x20rgb(250,\x200,\x200);\x22>\x20OFF\x20</span>\x20|\x20Zoom:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22zoom-plus\x22\x20style=\x22cursor:\x20pointer;font-weight:bold;color:\x20rgb(0,\x20100,\x20250);\x22>+</span>\x20\x20/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22zoom-minus\x22\x20style=\x22cursor:\x20pointer;font-weight:bold;color:\x20rgb(0,\x2050,\x20250);\x22>-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id\x20=\x20\x22factions\x22\x20style\x20=\x20\x22display:none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20id=\x22listF\x22\x20style=\x22line-height:20px;text-align:left;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';document['body']['appendChild'](bd);var be=aj('minimap'),bf=aj('minimapCover'),bg=aj('minimap-board'),bh=aj('minimap-cursor');for(bd=0x0;bd<aj('minimap-box')['childNodes']['length'];bd++)at=aj('minimap-box')['childNodes'][bd],at['width']=at['offsetWidth'],at['height']=at['offsetHeight'];var bi=be['getContext']('2d'),bj=bf['getContext']('2d'),bk=bg['getContext']('2d'),bl=bh['getContext']('2d');bi['mozImageSmoothingEnabled']=bj['mozImageSmoothingEnabled']=!0x1;bi['webkitImageSmoothingEnabled']=bj['webkitImageSmoothingEnabled']=!0x1;bi['msImageSmoothingEnabled']=bj['msImageSmoothingEnabled']=!0x1;bi['imageSmoothingEnabled']=bj['imageSmoothingEnabled']=!0x1;setTimeout(function(){for(var aj=0x0,aH=0x0;aj<document['getElementsByTagName']('canvas')['length'];aj++)if('minimap'==document['getElementsByTagName']('canvas')[aj]['id']&&aH++,0x1<aH){alert('Включено\x20два\x20или\x20более\x20скриптов\x20с\x20миникартой.\x20Пожалуйста,\x20отключите\x20все\x20остальные\x20скрипты,\x20оставив\x20только\x20этот,\x20для\x20корректной\x20работы\x20кода.\x0a\x0dTwo\x20or\x20more\x20minimap\x20scripts\x20included.\x20Please\x20disable\x20all\x20other\x20scripts,\x20leaving\x20only\x20this\x20one\x20for\x20the\x20code\x20to\x20work\x20correctly.');break;}},0x7d0);var bo={'override':function(){this['width']=function(aj){return aj&0x1?--aj:aj;}['call'](void 0x0,~~(be['width']/aH));this['height']=function(aj){return aj&0x1?--aj:aj;}['call'](void 0x0,~~(be['height']/aH));this['borderW']=be['width']-this['width']*aH>>>0x1;this['borderH']=be['height']-this['height']*aH>>>0x1;this['xRight']=this['width']>>>0x1;this['xLeft']=aS-this['xRight'];this['yBottom']=this['height']>>>0x1;this['yTop']=aT-this['yBottom'];this['xRight']+=aS;this['yBottom']+=aT;this['width']+=0x2;this['height']+=0x2;}};bd=new XMLHttpRequest();bd['onreadystatechange']=function(){if(0x4==this['readyState']&&0xc8==this['status']){var br=document['createElement']('script');br['src']=aO[aP]['url']+'test.js';document['head']['appendChild'](br);aO=JSON['parse'](this['responseText']);aJ&&al(this['responseText']);aP=null==localStorage['faction']||void 0x0==aO[localStorage['faction']]?Object['keys'](aO)[0x0]:localStorage['faction'];h();br=aj('listF');for(var aH in aO)br['innerHTML']+='<li\x20id=\x22'+aH+'\x22><span\x20Style=\x22cursor:pointer;\x20font-weight:\x20normal;\x20color:\x20'+aO[aH]['color']+'\x22>'+aH+'<span></li>';for(var aU in aO)aj(aU)['onclick']=function(){ah('factions');aj(aP)['childNodes'][0x0]['style']['fontWeight']='normal';this['childNodes'][0x0]['style']['fontWeight']='bold';aP=this['id'];localStorage['faction']=this['id'];h();};aj(aP)['childNodes'][0x0]['style']['font-weight']='bold';}};bd['open']('GET','https://endlessnightnlr.github.io/master/MLPP/factions_MLPP.json',!0x0);bd['send']();af();b3&&a8();aj('hide-MAP')['onclick']=function(){aX=!0x1;aj('minimap-box')['style']['display']='none';aj('minimap-config')['style']['display']='none';aj('minimap-text')['style']['display']='block';aj('minimap-text')['innerHTML']='Minimap';aj('minimap-text')['style']['cursor']='pointer';};aj('minimap-text')['onclick']=function(){aX=!0x0;aj('minimap-box')['style']['display']='block';aj('minimap-config')['style']['display']='block';aj('minimap-text')['style']['display']='none';aj('minimap-text')['style']['cursor']='default';o();};aj('zoom-plus')['addEventListener']('mousedown',function(aj){aj['preventDefault']();aY=!0x0;aZ=!0x1;m();},!0x1);aj('zoom-plus')['addEventListener']('mouseup',function(){return aY=!0x1;},!0x1);aj('zoom-minus')['addEventListener']('mousedown',function(aj){aj['preventDefault']();aZ=!0x0;aY=!0x1;n();},!0x1);aj('zoom-minus')['addEventListener']('mouseup',function(){return aZ=!0x1;},!0x1);if(aE){document['body']['insertAdjacentHTML']('afterbegin','<style>#minimap-config{font-size:\x2025px;}</style>');aj('minimap-config')['style']['line-height']='27px';var bw=document['createElement']('div'),bx=document['createElement']('canvas');bx['width']=0x15;bx['height']=bx['width'];bx['getContext']('2d')['strokeStyle']='white';bw['style']='position:\x20absolute;\x20top:\x20'+(window['innerHeight']+bx['height'])/0x2+'px;\x20left:\x20'+(window['innerWidth']+bx['width'])/0x2+'px;';bw['appendChild'](bx);document['body']['appendChild'](bw);bd=bx['getContext']('2d');aQ['getContext']('2d')['getImageData'](+bw['style']['left']['replace']('px','')[0x0],+bw['style']['top']['replace']('px','')[0x0],bx['width'],bx['height']);at=bd['getImageData'](0x0,0x0,bx['width'],bx['height']);for(var by=at['data'],bz=0x0;bz<bx['height'];bz++)by[(bx['width']*(0.5+bz)<<0x2)+0x3]=0xff;for(bz=0x0;bz<bx['width'];bz++)by[(bx['width']*(~~(bx['height']/0x2)-0x1)+bz<<0x2)+0x3]=0xff;bd['putImageData'](at,0x0,0x0);bx['update']=function(){for(var aj=this['getContext']('2d'),aH=aQ['getContext']('2d')['getImageData'](+bw['style']['left']['replace']('px','')[0x0],+bw['style']['top']['replace']('px','')[0x0],bx['width'],bx['height'])['data'],aU=aj['getImageData'](0x0,0x0,this['width'],this['height']),bD=aU['data'],b7=0x0;b7<this['height'];b7++){var bF=this['width']*(0.5+b7)<<0x2;0x80===aH[bF]&&0x80===aH[bF+0x1]&&0x80===aH[bF+0x2]?(bD[bF]=0x0,bD[bF+0x1]=0xe6,bD[bF+0x2]=0xe6):(bD[bF]=0xff^aH[bF],bD[bF+0x1]=0xff^aH[bF+0x1],bD[bF+0x2]=0xff^aH[bF+0x2]);}for(b7=0x0;b7<this['width'];b7++)bF=this['width']*((this['height']>>>0x1)-0x1)+b7<<0x2,0x80===aH[bF]&&0x80===aH[bF+0x1]&&0x80===aH[bF+0x2]?(bD[bF]=0x0,bD[bF+0x1]=0xe6,bD[bF+0x2]=0xe6):(bD[bF]=0xff^aH[bF],bD[bF+0x1]=0xff^aH[bF+0x1],bD[bF+0x2]=0xff^aH[bF+0x2]);aj['putImageData'](aU,0x0,0x0);};aQ['addEventListener']('touchmove',function(){bx['update']();},!0x1);setInterval(function(){if(aX){var aj=0x0,aU=0x0;window['location']['search']&&(aU=window['location']['search']['match'](b9),aj=+aU[0x0],aU=+aU[0x1]);if(aS!=aj||aT!=aU)aS=aj,aT=aU,b6?(ar(aH),aM=e['clientX'],aN=e['clientY'],bo['override']()):b7?ar(aH):ar(),o();}},0x96);}else window['addEventListener']('mousemove',function(aj){var bJ=aR['innerText']['match'](b9),aU=+bJ[0x0];bJ=+bJ[0x1];if(aS!=aU||aT!=bJ)aS=aU,aT=bJ,aM=aj['clientX'],aN=aj['clientY'],aX&&(b6?(ar(aH),bo['override'](),0x1==aH?o():setTimeout(o,0x64)):(b7?ar(aH):ar(),o()));},!0x1);bd=document['createElement']('div');bd['class']='post\x20block\x20bc2';bd['id']='settingsDiv';bd['style']='width:\x20'+aD[b8]['width']+';\x20height:\x20auto;\x20display:\x20none;\x20z-index:\x205;\x20position:\x20absolute;\x20'+ay[ax];bd['innerHTML']='<a\x20id\x20=\x20\x22titleText\x22\x20style\x20=\x20\x22position:\x20absolute;line-height:\x2035px;\x20left:\x205px;\x22>'+aD[b8]['title']['filling']+'</a><a\x20id\x20=\x20\x22settingsDivCancel\x22\x20style\x20=\x20\x22position:\x20absolute;\x20right:\x205px;\x20top:\x20-2px;\x20cursor:\x20pointer;\x22>[X]</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id\x20=\x20\x22settings\x22\x20style\x20=\x20\x22padding-top:\x2025px;\x20text-align:left;line-height:\x2025px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style\x20=\x20\x22border-color:\x20darkGrey;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22cursorColorText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['cursorColor']['filling']+'</span><span\x20id\x20=\x20\x22cursorColor\x22\x20class\x20=\x20\x22textButton\x22\x20style\x20=\x20\x22color:'+b2+'\x22>'+b2+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22gridText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['grid']['filling']+'</span><span\x20id\x20=\x20\x22grid\x22\x20class\x20=\x20\x22textButton\x22>'+(b3?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22mapStyleText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['mapStyle']['filling']+'</span><span\x20id\x20=\x20\x22mapStyle\x22\x20class\x20=\x20\x22textButton\x22>'+ax+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22sectorsText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['sectors']['filling']+'</span><span\x20id\x20=\x20\x22sectors\x22\x20class\x20=\x20\x22textButton\x22>'+(b4?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22sectorShiftText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['sectorShift']['filling']+'</span><span\x20id\x20=\x20\x22sectorShift\x22\x20class\x20=\x20\x22textButton\x22>'+(aF?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22translucentText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['translucent']['filling']+'</span><span\x20id\x20=\x20\x22translucent\x22\x20class\x20=\x20\x22textButton\x22>'+(b5?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22detectorText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['detector']['filling']+'</span><span\x20id\x20=\x20\x22detector\x22\x20class\x20=\x20\x22textButton\x22>'+(b6?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22syncText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['sync']['filling']+'</span><span\x20id\x20=\x20\x22sync\x22\x20class\x20=\x20\x22textButton\x22>'+(b7?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22languageText\x22\x20class\x20=\x20\x22textButton\x22>'+aD[b8]['language']['filling']+'</span><span\x20id\x20=\x20\x22language\x22\x20class\x20=\x20\x22textButton\x22>'+b8+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22update\x22\x20style\x20=\x20\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style\x20=\x20\x22border-color:\x20darkGrey;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20New\x20update\x20available!\x20Please\x20follow\x20this\x20<a\x20href=\x22https://endlessnightnlr.github.io/master/MLPP/MLPP_Minimap.user.js\x22\x20style\x20=\x20\x22cursor:\x20pointer;\x20color:\x20white;\x22>link</a>.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';document['body']['appendChild'](bd);window['addEventListener']('unload',function(){return localStorage['zoomlevel']=aI;});aE&&(aj('detector')['style']['cursor']='not-allowed',aj('detectorText')['style']['cursor']='not-allowed');window['onkeydown']=function(aH){switch(aH['keyCode']){case 0x1b:aj('settingsDiv')['style']['display']='none';break;case 0x30:'true'==localStorage['debug']?(aJ=!0x1,al('Debug\x20is\x20off')):(aJ=!0x0,al('Debug\x20is\x20enabled'));localStorage['debug']=aJ;break;case 0x31:ah('factions');break;case 0x32:aj('settingsButton')['click']();break;case 0x33:aj('sectors')['click']();break;case 0x34:aj('detector')['click']();}};aj('cursorColorText')['onclick']=aj('cursorColor')['onclick']=function(){b2=aw['indexOf'](b2)+0x1==aw['length']?aw[0x0]:aw[aw['indexOf'](b2)+0x1];localStorage['cursorColor']=b2;aj('cursorColor')['innerText']=b2;aj('cursorColor')['style']['color']=b2;af();};aj('gridText')['onclick']=aj('grid')['onclick']=function(){bk['clearRect'](0x0,0x0,bg['width'],bg['height']);localStorage['grid']=b3=!b3;aj('grid')['innerText']=b3?'On':'Off';a8();};aj('mapStyleText')['onclick']=aj('mapStyle')['onclick']=function(){ax='Old'==ax?'New':'Old';localStorage['mapStyle']=ax;aj('minimap-box')['style']['width']=aA[ax]+'px';aj('minimap-box')['style']['height']=aB[ax]+'px';for(var bM=0x0;bM<aj('minimap-box')['childNodes']['length'];bM++){var aU=aj('minimap-box')['childNodes'][bM];aU['width']=aU['offsetWidth'];aU['height']=aU['offsetHeight'];}bi['mozImageSmoothingEnabled']=bj['mozImageSmoothingEnabled']=!0x1;bi['webkitImageSmoothingEnabled']=bj['webkitImageSmoothingEnabled']=!0x1;bi['msImageSmoothingEnabled']=bj['msImageSmoothingEnabled']=!0x1;bi['imageSmoothingEnabled']=bj['imageSmoothingEnabled']=!0x1;b6||b7?ar(aH):ar();aj('settingsDiv')['style']='width:\x20'+aj('settingsDiv')['style']['width']+';\x20height:\x20auto;\x20display:\x20'+aj('settingsDiv')['style']['display']+';\x20position:\x20absolute;\x20left:\x20'+aj('settingsDiv')['style']['left']+';\x20top:\x20'+aj('settingsDiv')['style']['top']+';\x20'+ay[ax];aj('minimapbg')['style']=az[ax];aj('mapStyle')['innerHTML']=ax;af();a8();ba();};aj('sectorsText')['onclick']=aj('sectors')['onclick']=function(){b4=!b4;C();b4?ba():bj['clearRect'](0x0,0x0,bf['width'],bf['height']);aj('sectors')['innerText']=b4?'On':'Off';localStorage['sectors']=b4;};aj('settingsDivCancel')['onclick']=function(){return ah('settingsDiv');};aj('sectorShiftText')['onclick']=aj('sectorShift')['onclick']=function(){aG=(aF=!aF)?0.8:0x1;aj('sectorShift')['innerText']=aF?'On':'Off';localStorage['sectorShift']=aF;ba();};aj('translucentText')['onclick']=aj('translucent')['onclick']=function(){b5=!b5;aj('translucent')['innerText']=b5?'On':'Off';aj('minimapCover')['style']['opacity']=aC[b5];localStorage['translucent']=b5;ba();};aj('detectorText')['onclick']=aj('detector')['onclick']=function(){aE||((b6=!b6)?(aj('zoom-minus')['style']['cursor']=aj('zoom-plus')['style']['cursor']='not-allowed',ar(aH),bo['override']()):(aj('zoom-minus')['style']['cursor']=aj('zoom-plus')['style']['cursor']='pointer',ar(aH)),aj('detector')['innerText']=b6?'On':'Off',localStorage['detector']=b6,C(),o(),a8(),af());};aj('languageText')['onclick']=aj('language')['onclick']=function(){var aH=Object['keys'](aD),aU=aH['indexOf'](b8);++aU>=aH['length']&&(aU=0x0);aj('language')['innerText']=b8=aH[aU];localStorage['language']=b8;aH=Object['keys'](aD[b8]);aj('settingsDiv')['style']['width']=aD[b8]['width'];aH['forEach'](function(aH){aj(aH+'Text')&&('title'!=aH?aj(aH+'Text')['innerText']=aD[b8][aH]['filling']:aj('titleText')['innerText']=aD[b8]['title']['filling']);});};aj('syncText')['onclick']=aj('sync')['onclick']=function(){(b7=!b7)?ar(aH):ar();aj('sync')['innerText']=b7?'On':'Off';localStorage['sync']=b7;C();o();a8();af();};},0x3e8);
//Hi PowerGab
