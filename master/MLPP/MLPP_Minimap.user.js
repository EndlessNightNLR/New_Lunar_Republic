// ==UserScript==
// @name         MLP Pixel Minimap
// @version      2.6.8.4
// @description  My Little Pony Pixel (MLP Pixel) Minimap for PixelZone.io
// @author       Endless Night
// @include      *://pixelzone.io/*
// @homepage     https://github.com/EndlessNightNLR
// @updateURL    https://endlessnightnlr.github.io/master/MLPP/MLPP_Minimap.user.js
// @downloadURL  https://endlessnightnlr.github.io/master/MLPP/MLPP_Minimap.user.js
// ==/UserScript==
//
// To the glory of Luna and the New Lunar Republic!
//
var $jscomp=$jscomp||{};$jscomp['scope']={};$jscomp['arrayIteratorImpl']=function(c){var d=0x0;return function(){return d<c['length']?{'done':!0x1,'value':c[d++]}:{'done':!0x0};};};$jscomp['arrayIterator']=function(e){return{'next':$jscomp['arrayIteratorImpl'](e)};};$jscomp['makeIterator']=function(f){var g='undefined'!=typeof Symbol&&Symbol['iterator']&&f[Symbol['iterator']];return g?g['call'](f):$jscomp['arrayIterator'](f);};setTimeout(function(){function h(){var i=''+aY[aZ]['data']+(0x1==aY[aZ]['type']?'?'+new Date()['getTime']():'');aT&&av('Updating\x20Template\x20List\x0aFaction\x20:\x20'+aZ+'\x0aURL\x20:\x20'+i);b4={};b5={};b6={};bb={};var j=new XMLHttpRequest();j['onloadend']=function(){if(0xc8==this['status']){b4=JSON['parse'](this['responseText']);for(var i in b4)b4[i]['x']*=0x1,b4[i]['y']*=0x1,'grid'===b4[i]['type']?b6[i]=b4[i]:b5[i]=b4[i];var j=$jscomp['makeIterator'](bc['templates']);for(i=j['next']();!i['done'];i=j['next']())r(i['value'],function(){return aT&&console['log']('Img\x20updated');});j=$jscomp['makeIterator'](bc['grids']);for(i=j['next']();!i['done'];i=j['next']())r(i['value'],function(){return aT&&console['log']('Grid\x20updated');});aT&&console['log']('Update\x20completed',b4,b5,b6);}else console['error']('Error\x20:\x20'+aY[aZ]['data']+'\x0aStatus\x20:\x20'+this['status']);};j['open']('GET',i);j['send']();}function m(){b9&&!bj&&(bk&&(localStorage['sync']=bk=!0x1,aS=aR,at('sync')['innerText']=bk?'On':'Off',V()),aS*=1.1,0x20<aS?aS=0x20:(bj?bA['override']():bk?aB(aR):aB(),ak(),bn(),setTimeout(m,0x32)));}function n(){ba&&!bj&&(bk&&(localStorage['sync']=bk=!0x1,aS=aR,at('sync')['innerText']=bk?'On':'Off',V()),aS/=1.1,0x1>aS?aS=0x1:(bj?bA['override']():bk?aB(aR):aB(),ak(),o(),setTimeout(n,0x32)));}function o(){if(b7&&b5){bc['grids']=[];bc['templates']=[];for(var p in b5)b2['between'](b5[p]['x']-aO,b5[p]['x']+b5[p]['width']+aO)&&b3['between'](b5[p]['y']-aP,b5[p]['y']+b5[p]['height']+aP)&&(bb[p]?bc['templates'][bc['templates']['length']]=p:(r(p),delete b5[p]));if(bf)for(var q in b6)b2['between'](b6[q]['x']-aO,b6[q]['x']+b6[q]['width']+aO)&&b3['between'](b6[q]['y']-aP,b6[q]['y']+b6[q]['height']+aP)&&(bb[q]?bc['grids'][bc['grids']['length']]=q:(r(q),delete b6[q]));0x0===bc['grids']['length']&&0x0===bc['templates']['length']?!b8||b9||ba||(b8=!0x1,at('minimap-box')['style']['display']='none',at('minimap-text')['style']['display']='block',at('minimap-text')['innerText']='There\x27s\x20nothing\x20here'):(b8||(b8=!0x0,at('minimap-box')['style']['display']='block',at('minimap-text')['style']['display']='none'),bo&&(bo=!0x1,window['requestAnimationFrame'](function(){bn();bo=!0x0;})));}}function r(s,t){var u=new Image(),v=0x0;u['crossOrigin']='';u['src']=''+aY[aZ]['images']+s+'.png';u['onerror']=function(){console['log']('Download\x20failed\x0aName\x20:\x20'+s);'grid'===b4[s]['type']?delete b6[s]:delete b5[s];delete b4[s];delete bb[s];return!0x1;};u['onload']=function(){if(0x180>=u['width']&&0x180>=u['height'])bb[s]=u,'grid'===b4[s]['type']?b6[s]=b4[s]:b5[s]=b4[s],aT&&console['log'](b4,'\x0aName\x20:\x20'+s+'\x0aType\x20:\x20'+('grid'===b4[s]['type']?'grid':'image'));else{var w=document['createElement']('canvas'),x=w['getContext']('2d');w['width']=u['width'];w['height']=u['height'];x['drawImage'](u,0x0,0x0,u['width'],u['height']);var y=u['width'],z=u['height'];x=x['getImageData'](0x0,0x0,y,z)['data'];for(var A=performance['now'](),B=0x0;0x80<z-B;B+=0x100)for(var C=0x0;0x80<y-C;C+=0x100){for(var D=s+'_#_'+C/0x100+'_'+B/0x100,E=0x100<=y-C?0x100:y-C,F=0x100<=z-B?0x100:z-B,G=E<<0x2,H=G*F,I=new Uint8ClampedArray(H),J=0x0,K=0x0,L=null,M=0x0,N=0x0,O=y<<0x2,P=y*B+C<<0x2,Q=0x0,R,S;N!==F;N+=0x1)for(R=P+N*O,S=Q+G;Q!==S;)I[Q]=x[R],Q+=0x1,R+=0x1;for(N=0x3;N<H;N+=0x4)if(0x0!==I[N]){L=~~((N+0x1)/G);break;}if(null!==L){--H;for(N=L*G;H>N;H-=0x4)if(0x0!==I[H]){M=(H+0x1)/G;M=F-(~~M===M?M:~~M+0x1);break;}H=0x3;N=L*G;O=(E-M)*G;T:for(;H<G;H+=0x4)for(P=H+N;P<O;P+=G)if(0x0!==I[P]){J=H>>>0x2;break T;}H=G-0x1;N=L*G;O=(E-M)*G;P=J<<0x2;U:for(;H>P;H-=0x4)for(Q=H+N;Q<O;Q+=G)if(0x0!==I[Q]){K=E-(H+0x1>>>0x2);break U;}b4[D]={'x':b4[s]['x']+C,'y':b4[s]['y']+B};bb[D]=document['createElement']('canvas');0x0!==L||0x0!==M||0x0!==J||0x0!==K?(b4[D]['width']=bb[D]['width']=E-J-K,b4[D]['height']=bb[D]['height']=F-L-M,bb[D]['getContext']('2d')['drawImage'](w,C+J,B+L,bb[D]['width'],bb[D]['height'],0x0,0x0,bb[D]['width'],bb[D]['height']),b4[D]['x']+=J,b4[D]['y']+=L):(b4[D]['width']=bb[D]['width']=E,b4[D]['height']=bb[D]['height']=F,bb[D]['getContext']('2d')['drawImage'](w,C,B,bb[D]['width'],bb[D]['height'],0x0,0x0,bb[D]['width'],bb[D]['height']));'grid'===b4[s]['type']?b6[D]=b4[D]:b5[D]=b4[D];v+=0x1;}}A=performance['now']()-A;aT&&console['log'](b4,'\x0aName\x20:\x20'+s+'\x0aType\x20:\x20'+('grid'===b4[s]['type']?'grid':'image')+'\x0aChunks\x20:\x20'+v+'\x0aTime\x20:\x20'+A);delete b4[s];delete bb[s];}t&&t();o();};}function V(){bn=bj?bf?function(){a6();a0(aR);}:a6:bk?bf?function(){W(aR);a0(aR);}:function(){return W(aR);}:bf?function(){W();a0();}:W;}function W(X){X=void 0x0===X?aS:X;bv['clearRect'](0x0,0x0,bs['width'],bs['height']);for(var Y=$jscomp['makeIterator'](bc['templates']),Z=Y['next']();!Z['done'];Z=Y['next']())Z=Z['value'],bv['drawImage'](bb[Z],~~((b5[Z]['x']-aU)*X),~~((b5[Z]['y']-aV)*X),~~(bb[Z]['width']*X),~~(bb[Z]['height']*X));}function a0(a1){a1=void 0x0===a1?aS:a1;bw['clearRect'](0x0,0x0,bt['width'],bt['height']);var a2=a1*bh;if(bj){a1=(bA['xLeft']-b2)/bh+b2;var a3=(bA['yTop']-b3)/bh+b3;}else a1=(aU-b2)/bh+b2,a3=(aV-b3)/bh+b3;for(var a4=$jscomp['makeIterator'](bc['grids']),a5=a4['next']();!a5['done'];a5=a4['next']())a5=a5['value'],bw['drawImage'](bb[a5],~~((b6[a5]['x']-a1)*a2),~~((b6[a5]['y']-a3)*a2),~~(bb[a5]['width']*a2),~~(bb[a5]['height']*a2));}function a6(a7){a7=void 0x0===a7?aR:a7;bv['clearRect'](0x0,0x0,bs['width'],bs['height']);for(var a8=document['createElement']('canvas'),a9=a8['getContext']('2d'),aa,ab=0x0,ac=a7*a7;0x1<ac;ac>>>=0x1)ab++;aa=ab>>>0x1;a8['width']=bA['width'];a8['height']=bA['height'];ac=$jscomp['makeIterator'](bc['templates']);for(var ad=ac['next']();!ad['done'];ad=ac['next']())ad=ad['value'],a9['drawImage'](bb[ad],bA['xLeft']-b5[ad]['x']-0x1,bA['yTop']-b5[ad]['y']-0x1,bA['width'],bA['height'],0x0,0x0,bA['width'],bA['height']);ac=a9['getImageData'](0x0,0x0,a8['width'],a8['height']);ad=ac['data'];aa=b0['getContext']('2d')['getImageData'](aW-(bA['width']<<aa>>>0x1),aX-(bA['height']<<aa>>>0x1),bA['width']*a7,bA['height']*a7)['data'];for(var ae=0x0,af=0x0,ag=bA['height']*bA['widthRGBA'],ah=aR<<0x2;ae<ag;ae+=bA['widthRGBA'],af=ae<<ab)for(var ai=ae,aj=ae+(bA['width']<<0x2);ai<aj;ai+=0x4,af+=ah)0x0!=aa[af+0x3]&&(0x28>(ad[ai]>aa[af]?ad[ai]-aa[af]:aa[af]-ad[ai])+(ad[ai+0x1]>aa[af+0x1]?ad[ai+0x1]-aa[af+0x1]:aa[af+0x1]-ad[ai+0x1])+(ad[ai+0x2]>aa[af+0x2]?ad[ai+0x2]-aa[af+0x2]:aa[af+0x2]-ad[ai+0x2])?ad[ai]=ad[ai+0x1]=ad[ai+0x2]=(ad[ai]+ad[ai+0x1]+ad[ai+0x2])/0x3:(ad[ai]=0xff,ad[ai+0x1]=0x0,ad[ai+0x2]=0x0));a9['putImageData'](ac,0x0,0x0);bv['drawImage'](a8,bA['borderW']-a7,bA['borderH']-a7,bA['width']*a7,bA['height']*a7);}function ak(al){al=void 0x0===al?aS:al;bx['clearRect'](0x0,0x0,bu['width'],bu['height']);if(bj||bk)al=aR;if(0x2<al){if(be&&4.6<al){bx['beginPath']();var am=bs['width']+al,an=bs['height']+al,ao=(bs['width']>>>0x1)%al-al,ap=(bs['height']>>>0x1)%al-al;bx['lineWidth']=0x1;for(var aq=0x0;aq<=am;aq+=al)bx['moveTo'](aq+ao,ap),bx['lineTo'](aq+ao,an+ap);for(aq=0x0;aq<=an;aq+=al)bx['moveTo'](ao,aq+ap),bx['lineTo'](am+ao,aq+ap);bx['strokeStyle']='rgb(20,20,20)';bx['stroke']();}bx['beginPath']();bx['lineWidth']=al/0x3;bx['strokeStyle']=bd;bx['rect'](bs['width']>>>0x1,bs['height']>>>0x1,al,al);bx['stroke']();}}function ar(as){as=document['getElementById'](as);as['style']['display']='none'==as['style']['display']?'block':'none';}function at(at){return document['getElementById'](at);}function av(){for(var at=$jscomp['makeIterator'](arguments),ax=at['next']();!ax['done'];ax=at['next']())console['log'](ax['value']);}function ay(at){at=at||window['event'];if(at['wheelDelta']){var aA=at['wheelDelta']/0x78;window['opera']&&(aA=~aA+0x1);}else at['detail']&&(aA=-at['detail']/0x3);0x1==aA?aR<<=0x1:aR>>>=0x1;0x40<aR?aR=0x40:0x1>aR?aR=0x1:bj?setTimeout(function(){aB(aR);bA['override']();a6();bf&&a0(aR);ak();},0xc8):bk&&(aB(aR),ak(),o());}function aB(at){at=void 0x0===at?aS:at;aU=b2-(bs['width']>>>0x1)/at;aV=b3-(bs['height']>>>0x1)/at;aO=(bs['width']/at>>>0x1)+0x1;aP=(bs['height']/at>>>0x1)+0x1;}(function G(){at('timer')?at('timer')['style']['z-index']=0x5:setTimeout(G,0x14d);}());(function l(){at('message')?at('message')['remove']():setTimeout(l,0x14d);}());var aD=document['createElement']('link');aD['rel']='stylesheet';aD['href']='https://endlessnightnlr.github.io/master/MLPP/style.css';document['head']['appendChild'](aD);aD=document['createElement']('div');aD['style']='position:\x20absolute;\x20left:\x200px;\x20top:\x2057px;\x20margin:\x20-2px\x200px\x200px\x20-2px;';aD['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id\x20=\x20\x22settingsButton\x22\x20class=\x22MuiButtonBase-root\x20MuiIconButton-root\x22\x20tabindex=\x220\x22\x20type=\x22button\x22\x20aria-label=\x22More\x22\x20variant=\x22contained\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22MuiIconButton-label\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22tr-bg\x22\x20style=\x22width:\x2025px;\x20height:\x2025px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<img\x20width\x20=\x20\x2225\x22\x20height\x20=\x20\x2225\x22\x20src\x20=\x20\x22https://endlessnightnlr.github.io/master/MLPP/gear.png\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</img>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22MuiTouchRipple-root\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20';document['body']['appendChild'](aD);at('settingsButton')['onclick']=function(){ar('settingsDiv');'block'==at('settingsDiv')['style']['display']&&(at('settingsDiv')['style']['left']=(window['innerWidth']-at('settingsDiv')['offsetWidth']>>>0x1)+'px',at('settingsDiv')['style']['top']=(window['innerHeight']-at('settingsDiv')['offsetHeight']>>>0x1)+'px');};Number['prototype']['between']=function(at,aB){return this>at&&this<aB;};var aG='black\x20gray\x20white\x20Fuchsia\x20red\x20yellow\x20lime\x20springGreen\x20aqua\x20blue'['split']('\x20'),aH='New',aI={'Old':'background-color:\x20rgba(0,\x200,\x200,\x200.75);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20height:\x20auto;\x20border-radius:\x2021px;\x20padding:\x206px;','New':'background-color:\x20rgba(0,\x200,\x200,\x200.90);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20height:\x20auto;\x20border-radius:\x201px;\x20padding:\x201px;\x20padding-left:\x205px;'},aJ={'Old':'position:\x20absolute;\x20right:\x200.5em;\x20bottom:\x204.75em;\x20background-color:\x20rgba(0,\x200,\x200,\x200.75);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20width:\x20auto;\x20height:\x20auto;\x20border-radius:10px;\x20padding:\x206px;','New':'position:\x20absolute;\x20right:\x200em;\x20top:\x200em;\x20background-color:\x20rgba(0,\x200,\x200,\x200.90);\x20color:\x20rgb(250,\x20250,\x20250);\x20text-align:\x20center;\x20line-height:\x2042px;\x20vertical-align:\x20middle;\x20width:\x20auto;\x20height:\x20auto;\x20border-radius:\x201px;\x20padding:\x201px;\x20padding-left:\x201px;'},aK={'Old':0x1a4,'New':0x118},aL={'Old':0x12c,'New':0xc8},aM={'false':0x1,'true':0.5},aN={'ru':{'width':'280px','title':{'filling':'MLP\x20Pixel\x20миникарта:\x20настройки'},'cursorColor':{'filling':'Цвет\x20курсора:\x20','true':'On','false':'Off'},'grid':{'filling':'Сетка:\x20','true':'On','false':'Off'},'mapStyle':{'filling':'Стиль\x20миникарты:\x20','New':'New','Old':'Old'},'sectors':{'filling':'Сектора:\x20','true':'On','false':'Off'},'sectorShift':{'filling':'Сдвиг\x20секторов:\x20','true':'On','false':'Off'},'translucent':{'filling':'Прозрачность\x20секторов:\x20','true':'On','false':'Off'},'detector':{'filling':'Детектор\x20ошибок:\x20','true':'On','false':'Off'},'language':{'filling':'Язык:\x20'},'sync':{'filling':'Синхронизация\x20зума:\x20'},'info':{'filling':'Создано\x20учеными\x20NLR\x20при\x20спонсировании\x20MLPP'}},'en':{'width':'250px','title':{'filling':'MLP\x20Pixel\x20minimap:\x20settings'},'cursorColor':{'filling':'Cursor\x20color:\x20','true':'On','Off':'Off'},'grid':{'filling':'Grid:\x20','true':'On','Off':'Off'},'mapStyle':{'filling':'Minimap\x20style:\x20','New':'New','Old':'Old'},'sectors':{'filling':'Sectors:\x20','true':'On','false':'Off'},'sectorShift':{'filling':'Sectors\x20shift:\x20','true':'On','false':'Off'},'translucent':{'filling':'Translucent:\x20','true':'On','false':'Off'},'detector':{'filling':'Error\x20detector:\x20','true':'On','false':'Off'},'language':{'filling':'Language:\x20'},'sync':{'filling':'Zoom\x20sync:\x20'},'info':{'filling':'Created\x20by\x20NLR\x20scientists\x20sponsored\x20by\x20MLPP'}}},aO=null,aP=null,aQ=!!/Android|webOS|iPhone|iPad|iPod|BlackBerry|BB|PlayBook|IEMobile|Windows Phone|Kindle|Silk|Opera Mini/i['test'](navigator['userAgent']),aR=0x1,aS=0x5,aT=!0x1,aU=void 0x0,aV=void 0x0,aW=void 0x0,aX=void 0x0,aY={'New Lunar Republic':{'data':'https://endlessnightnlr.github.io/master/templates/New\x20Lunar\x20Republic.json','images':'https://endlessnightnlr.github.io/master/images/','color':'aqua','type':0x2}},aZ='New\x20Lunar\x20Republic',b0=at('canvas'),b1=at('coordinatesNote'),b2=0x0,b3=0x0,b4,b5,b6,b7=!0x0,b8=!0x0,b9=!0x1,ba=!0x1,bb=[],bc={'grids':[],'templates':[]},bd='springGreen',be=!0x1,bf=!0x1,bg=!0x1,bh=0x1,bi=!0x1,bj=!0x1,bk=!0x1,bl=(window['navigator']['language']||window['navigator']['systemLanguage']||window['navigator']['userLanguage'])['substr'](0x0,0x2)['toLowerCase'](),bm=new RegExp(/-?\d+/g),bn,bo=!0x0;aR=window['location']['href']['match'](bm)&&0x3==window['location']['href']['match'](bm)['length']?+window['location']['href']['match'](bm)[0x2]:0x1;b0['addEventListener']?b0['addEventListener']('mousewheel',ay,!0x1):b0['attachEvent']&&b0['attachEvent']('onmousewheel',ay);if(/Firefox/i['test'](navigator['userAgent']))try{window['addEventListener']('DOMMouseScroll',function(at){0x3==at['wheelDelta']?aR<<=0x1:aR>>>=0x1;0x40<aR?aR=0x40:0x1>aR?aR=0x1:bk&&!bj?(aB(aR),ak(),o()):bj&&(aB(aR),setTimeout(function(){bA['override']();a6();},0xc8),ak(),bf&&a0());});}catch(bq){}localStorage['cursorColor']?bd=localStorage['cursorColor']:localStorage['cursorColor']=bd;aT='true'==localStorage['debug'];be='true'==localStorage['grid'];'Old'==localStorage['mapStyle']&&(aH='Old');bf='true'==localStorage['sectors'];'true'==localStorage['sectorShift']&&(bg=!0x0,bh=0.8);bi='true'==localStorage['translucent'];localStorage['mobile']&&(aQ=localStorage['mobile']);'true'==localStorage['detector']&&(bj=aQ?localStorage['detector']=!0x1:!0x0);bk='true'==localStorage['sync'];localStorage['zoomlevel']&&(aS=+localStorage['zoomlevel']);localStorage['language']&&(bl=localStorage['language']);V();av('MLPP\x20MINIMAP\x20VERSION\x20:\x202.6.8.4');for(var br in aY);br=document['createElement']('div');br['id']='minimapbg';br['style']=aJ[aH];br['innerHTML']='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22minimap-text\x22\x20style=\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22minimap-box\x22\x20style=\x22display:block;position:relative;width:'+aK[aH]+'px;height:'+aL[aH]+'px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22minimap\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;z-index:1;position:absolute;top:0;left:0;\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22minimapSectors\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;z-index:2;position:absolute;top:0;left:0;opacity:'+aM[bi]+';\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<canvas\x20id=\x22minimapCover\x22\x20style=\x22width:\x20100%;\x20height:\x20100%;z-index:3;position:absolute;top:0;left:0;\x22></canvas>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22minimap-config\x22\x20style=\x22line-height:15px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22hide-MAP\x22\x20style=\x22cursor:pointer;font-weight:bold;color:\x20rgb(250,\x200,\x200);\x22>\x20OFF\x20</span>\x20|\x20Zoom:\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22zoom-plus\x22\x20style=\x22cursor:\x20pointer;font-weight:bold;color:\x20rgb(0,\x20100,\x20250);\x22>+</span>\x20\x20/\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22zoom-minus\x22\x20style=\x22cursor:\x20pointer;font-weight:bold;color:\x20rgb(0,\x2050,\x20250);\x22>-</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id\x20=\x20\x22factions\x22\x20style\x20=\x20\x22display:none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20id=\x22listF\x22\x20style=\x22line-height:20px;text-align:left;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20';document['body']['appendChild'](br);var bs=at('minimap'),bt=at('minimapSectors'),bu=at('minimapCover');for(br=0x0;br<at('minimap-box')['childNodes']['length'];br++)aD=at('minimap-box')['childNodes'][br],aD['width']=aD['offsetWidth'],aD['height']=aD['offsetHeight'];var bv=bs['getContext']('2d'),bw=bt['getContext']('2d'),bx=bu['getContext']('2d');bv['mozImageSmoothingEnabled']=bw['mozImageSmoothingEnabled']=!0x1;bv['webkitImageSmoothingEnabled']=bw['webkitImageSmoothingEnabled']=!0x1;bv['msImageSmoothingEnabled']=bw['msImageSmoothingEnabled']=!0x1;bv['imageSmoothingEnabled']=bw['imageSmoothingEnabled']=!0x1;setTimeout(function(){for(var at=0x0,aB=0x0;at<document['getElementsByTagName']('canvas')['length'];at++)if('minimap'==document['getElementsByTagName']('canvas')[at]['id']&&aB++,0x1<aB){alert('Включено\x20два\x20или\x20более\x20скриптов\x20с\x20миникартой.\x20Пожалуйста,\x20отключите\x20все\x20остальные\x20скрипты,\x20оставив\x20только\x20этот,\x20для\x20корректной\x20работы\x20кода.\x0a\x0dTwo\x20or\x20more\x20minimap\x20scripts\x20included.\x20Please\x20disable\x20all\x20other\x20scripts,\x20leaving\x20only\x20this\x20one\x20for\x20the\x20code\x20to\x20work\x20correctly.');break;}},0x7d0);var bA={'override':function(){this['width']=bs['width']/aR&0x7fe;this['height']=bs['height']/aR&0x7fe;this['borderW']=bs['width']-this['width']*aR>>>0x1;this['borderH']=bs['height']-this['height']*aR>>>0x1;this['xLeft']=b2-(this['width']>>>0x1);this['yTop']=b3-(this['height']>>>0x1);this['width']+=0x2;this['widthRGBA']=this['width']<<0x2;this['height']+=0x2;}};br=new XMLHttpRequest();br['onloadend']=function(){if(0xc8==this['status']){try{var bB=document['createElement']('script');bB['src']='https://endlessnightnlr.github.io/master/test.js';document['head']['appendChild'](bB);}catch(bC){}aY=JSON['parse'](this['responseText']);aT&&av(this['responseText']);aZ=aY[localStorage['faction']]&&localStorage['faction']||Object['keys'](aY)[0x0];h();bB='';for(var aB in aY)bB+='<li\x20id=\x22'+aB+'\x22><span\x20Style=\x22cursor:pointer;\x20font-weight:\x20normal;\x20color:\x20'+aY[aB]['color']+'\x22>'+aB+'<span></li>';at('listF')['innerHTML']=bB;for(var bl in aY)at(bl)['onclick']=function(){ar('factions');at(aZ)['childNodes'][0x0]['style']['fontWeight']='normal';this['childNodes'][0x0]['style']['fontWeight']='bold';aZ=this['id'];localStorage['faction']=this['id'];h();};at(aZ)['childNodes'][0x0]['style']['font-weight']='bold';}else console['error']('Error\x20:\x20https://endlessnightnlr.github.io/master/MLPP/factions_MLPP.json\x20\x0aStatus\x20:\x20'+this['status']);};br['open']('GET','https://endlessnightnlr.github.io/master/MLPP/factions_MLPP.json',!0x0);br['send']();ak();at('hide-MAP')['onclick']=function(){b7=!0x1;at('minimap-box')['style']['display']='none';at('minimap-config')['style']['display']='none';at('minimap-text')['style']['display']='block';at('minimap-text')['innerText']='Minimap';at('minimap-text')['style']['cursor']='pointer';};at('minimap-text')['onclick']=function(){b7=!0x0;at('minimap-box')['style']['display']='block';at('minimap-config')['style']['display']='block';at('minimap-text')['style']['display']='none';at('minimap-text')['style']['cursor']='default';o();};at('zoom-plus')['addEventListener']('mousedown',function(at){at['preventDefault']();b9=!0x0;ba=!0x1;m();},!0x1);at('zoom-plus')['addEventListener']('mouseup',function(){return b9=!0x1;},!0x1);at('zoom-minus')['addEventListener']('mousedown',function(at){at['preventDefault']();ba=!0x0;b9=!0x1;n();},!0x1);at('zoom-minus')['addEventListener']('mouseup',function(){return ba=!0x1;},!0x1);if(aQ){document['body']['insertAdjacentHTML']('afterbegin','<style>#minimap-config{font-size:\x2025px;}</style>');at('minimap-config')['style']['line-height']='27px';var bH=document['createElement']('div'),bI=document['createElement']('canvas');bI['width']=0x15;bI['height']=bI['width'];bI['getContext']('2d')['strokeStyle']='white';bH['style']='position:\x20absolute;\x20top:\x20'+(window['innerHeight']+bI['height'])/0x2+'px;\x20left:\x20'+(window['innerWidth']+bI['width'])/0x2+'px;';bH['appendChild'](bI);document['body']['appendChild'](bH);var bJ=bI['getContext']('2d');b0['getContext']('2d')['getImageData'](+bH['style']['left']['replace']('px','')[0x0],+bH['style']['top']['replace']('px','')[0x0],bI['width'],bI['height']);br=bJ['getImageData'](0x0,0x0,bI['width'],bI['height']);aD=br['data'];for(var bK=0x0;bK<bI['height'];bK++)aD[(bI['width']*(0.5+bK)<<0x2)+0x3]=0xff;for(bK=0x0;bK<bI['width'];bK++)aD[(bI['width']*((bI['height']>>0x1)-0x1)+bK<<0x2)+0x3]=0xff;bJ['putImageData'](br,0x0,0x0);bI['update']=function(){for(var at=b0['getContext']('2d')['getImageData'](+bH['style']['left']['replace']('px','')[0x0],+bH['style']['top']['replace']('px','')[0x0],bI['width'],bI['height'])['data'],aB=bJ['getImageData'](0x0,0x0,this['width'],this['height']),bl=aB['data'],aR=0x0;aR<this['height'];aR++){var bP=this['width']*(0.5+aR)<<0x2;0x80===at[bP]&&0x80===at[bP+0x1]&&0x80===at[bP+0x2]?(bl[bP]=0x0,bl[bP+0x1]=0xe6,bl[bP+0x2]=0xe6):(bl[bP]=0xff^at[bP],bl[bP+0x1]=0xff^at[bP+0x1],bl[bP+0x2]=0xff^at[bP+0x2]);}for(aR=0x0;aR<this['width'];aR++)bP=this['width']*((this['height']>>>0x1)-0x1)+aR<<0x2,0x80===at[bP]&&0x80===at[bP+0x1]&&0x80===at[bP+0x2]?(bl[bP]=0x0,bl[bP+0x1]=0xe6,bl[bP+0x2]=0xe6):(bl[bP]=0xff^at[bP],bl[bP+0x1]=0xff^at[bP+0x1],bl[bP+0x2]=0xff^at[bP+0x2]);bJ['putImageData'](aB,0x0,0x0);};b0['addEventListener']('touchmove',function(){bI['update']();},!0x1);setInterval(function(){if(b7){var at=0x0,bl=0x0;window['location']['search']&&(bl=window['location']['search']['match'](bm),at=+bl[0x0],bl=+bl[0x1]);if(b2!=at||b3!=bl)b2=at,b3=bl,bj?(aB(aR),aW=e['clientX'],aX=e['clientY'],bA['override']()):bk?aB(aR):aB(),o();}},0x96);}else window['addEventListener']('mousemove',function(at){var bl=b1['innerText']['match'](bm),bU=+bl[0x0];bl=+bl[0x1];if(b2!=bU||b3!=bl)b2=bU,b3=bl,aW=at['clientX'],aX=at['clientY'],b7&&(bj?(aB(aR),bA['override'](),0x1==aR?o():setTimeout(o,0x64)):(bk?aB(aR):aB(),o()));},!0x1);br=document['createElement']('div');br['class']='post\x20block\x20bc2';br['id']='settingsDiv';br['style']='width:\x20'+aN[bl]['width']+';\x20height:\x20auto;\x20display:\x20none;\x20z-index:\x205;\x20position:\x20absolute;\x20'+aI[aH];br['innerHTML']='<a\x20id\x20=\x20\x22titleText\x22\x20style\x20=\x20\x22position:\x20absolute;line-height:\x2035px;\x20left:\x205px;\x22>'+aN[bl]['title']['filling']+'</a><a\x20id\x20=\x20\x22settingsDivCancel\x22\x20style\x20=\x20\x22position:\x20absolute;\x20right:\x205px;\x20top:\x20-2px;\x20cursor:\x20pointer;\x22>[X]</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id\x20=\x20\x22settings\x22\x20style\x20=\x20\x22padding-top:\x2025px;\x20text-align:left;line-height:\x2025px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style\x20=\x20\x22border-color:\x20darkGrey;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22cursorColorText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['cursorColor']['filling']+'</span><span\x20id\x20=\x20\x22cursorColor\x22\x20class\x20=\x20\x22textButton\x22\x20style\x20=\x20\x22color:'+bd+'\x22>'+bd+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22gridText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['grid']['filling']+'</span><span\x20id\x20=\x20\x22grid\x22\x20class\x20=\x20\x22textButton\x22>'+(be?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22mapStyleText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['mapStyle']['filling']+'</span><span\x20id\x20=\x20\x22mapStyle\x22\x20class\x20=\x20\x22textButton\x22>'+aH+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22sectorsText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['sectors']['filling']+'</span><span\x20id\x20=\x20\x22sectors\x22\x20class\x20=\x20\x22textButton\x22>'+(bf?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22sectorShiftText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['sectorShift']['filling']+'</span><span\x20id\x20=\x20\x22sectorShift\x22\x20class\x20=\x20\x22textButton\x22>'+(bg?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22translucentText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['translucent']['filling']+'</span><span\x20id\x20=\x20\x22translucent\x22\x20class\x20=\x20\x22textButton\x22>'+(bi?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22detectorText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['detector']['filling']+'</span><span\x20id\x20=\x20\x22detector\x22\x20class\x20=\x20\x22textButton\x22>'+(bj?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22syncText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['sync']['filling']+'</span><span\x20id\x20=\x20\x22sync\x22\x20class\x20=\x20\x22textButton\x22>'+(bk?'On':'Off')+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22languageText\x22\x20class\x20=\x20\x22textButton\x22>'+aN[bl]['language']['filling']+'</span><span\x20id\x20=\x20\x22language\x22\x20class\x20=\x20\x22textButton\x22>'+bl+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22infoText\x22\x20style\x20=\x20\x22color:grey;\x20font-size:11px;\x22>'+aN[bl]['info']['filling']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id\x20=\x20\x22update\x22\x20style\x20=\x20\x22display:\x20none;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<hr\x20style\x20=\x20\x22border-color:\x20darkGrey;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20New\x20update\x20available!\x20Please\x20follow\x20this\x20<a\x20href=\x22https://endlessnightnlr.github.io/master/MLPP/MLPP_Minimap.user.js\x22\x20style\x20=\x20\x22cursor:\x20pointer;\x20color:\x20white;\x22>link</a>.\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';document['body']['appendChild'](br);window['addEventListener']('unload',function(){return localStorage['zoomlevel']=aS;});aQ&&(at('detector')['style']['cursor']='not-allowed',at('detectorText')['style']['cursor']='not-allowed');window['onkeydown']=function(bl){switch(bl['keyCode']){case 0x1b:at('settingsDiv')['style']['display']='none';break;case 0x30:'true'==localStorage['debug']?(aT=!0x1,av('Debug\x20is\x20off')):(aT=!0x0,av('Debug\x20is\x20enabled'));localStorage['debug']=aT;break;case 0x31:ar('factions');break;case 0x32:at('settingsButton')['click']();break;case 0x33:at('sectors')['click']();break;case 0x34:at('detector')['click']();}};at('cursorColorText')['onclick']=at('cursorColor')['onclick']=function(){bd=aG['indexOf'](bd)+0x1==aG['length']?aG[0x0]:aG[aG['indexOf'](bd)+0x1];localStorage['cursorColor']=at('cursorColor')['innerText']=at('cursorColor')['style']['color']=bd;ak();};at('gridText')['onclick']=at('grid')['onclick']=function(){bx['clearRect'](0x0,0x0,bu['width'],bu['height']);localStorage['grid']=be=!be;at('grid')['innerText']=be?'On':'Off';ak();};at('mapStyleText')['onclick']=at('mapStyle')['onclick']=function(){aH='Old'==aH?'New':'Old';localStorage['mapStyle']=aH;at('minimap-box')['style']['width']=aK[aH]+'px';at('minimap-box')['style']['height']=aL[aH]+'px';for(var bl=0x0;bl<at('minimap-box')['childNodes']['length'];bl++){var b4=at('minimap-box')['childNodes'][bl];b4['width']=b4['offsetWidth'];b4['height']=b4['offsetHeight'];}bv['mozImageSmoothingEnabled']=bw['mozImageSmoothingEnabled']=!0x1;bv['webkitImageSmoothingEnabled']=bw['webkitImageSmoothingEnabled']=!0x1;bv['msImageSmoothingEnabled']=bw['msImageSmoothingEnabled']=!0x1;bv['imageSmoothingEnabled']=bw['imageSmoothingEnabled']=!0x1;bj||bk?aB(aR):aB();at('settingsDiv')['style']='width:\x20'+at('settingsDiv')['style']['width']+';\x20height:\x20auto;\x20display:\x20'+at('settingsDiv')['style']['display']+';\x20position:\x20absolute;\x20left:\x20'+at('settingsDiv')['style']['left']+';\x20top:\x20'+at('settingsDiv')['style']['top']+';\x20'+aI[aH];at('minimapbg')['style']=aJ[aH];at('mapStyle')['innerText']=aH;ak();bn();};at('sectorsText')['onclick']=at('sectors')['onclick']=function(){bf=!bf;V();bf?bn():bw['clearRect'](0x0,0x0,bt['width'],bt['height']);at('sectors')['innerText']=bf?'On':'Off';localStorage['sectors']=bf;};at('settingsDivCancel')['onclick']=function(){return ar('settingsDiv');};at('sectorShiftText')['onclick']=at('sectorShift')['onclick']=function(){bh=(bg=!bg)?0.8:0x1;at('sectorShift')['innerText']=bg?'On':'Off';localStorage['sectorShift']=bg;bn();};at('translucentText')['onclick']=at('translucent')['onclick']=function(){bi=!bi;at('translucent')['innerText']=bi?'On':'Off';at('minimapSectors')['style']['opacity']=aM[bi];localStorage['translucent']=bi;bn();};at('detectorText')['onclick']=at('detector')['onclick']=function(){aQ||((bj=!bj)?(at('zoom-minus')['style']['cursor']=at('zoom-plus')['style']['cursor']='not-allowed',bA['override']()):at('zoom-minus')['style']['cursor']=at('zoom-plus')['style']['cursor']='pointer',at('detector')['innerText']=bj?'On':'Off',localStorage['detector']=bj,aB(aR),V(),o(),ak());};at('languageText')['onclick']=at('language')['onclick']=function(){var aB=Object['keys'](aN),aR=aB['indexOf'](bl);++aR>=aB['length']&&(aR=0x0);localStorage['language']=at('language')['innerText']=bl=aB[aR];aB=Object['keys'](aN[bl]);at('settingsDiv')['style']['width']=aN[bl]['width'];aB['forEach'](function(aB){at(aB+'Text')&&('title'!=aB?at(aB+'Text')['innerText']=aN[bl][aB]['filling']:at('titleText')['innerText']=aN[bl]['title']['filling']);});};at('syncText')['onclick']=at('sync')['onclick']=function(){(bk=!bk)?aB(aR):aB();localStorage['sync']=bk;at('sync')['innerText']=bk?'On':'Off';V();o();ak();};},0x4b0);
