var d=c("canvas"),e=d.getContext("2d"),g=c("minTime"),k,l,m,n=c("width").value,p=c("height").value,q,r,t=!1,v,w=1E3,x,y=!1,z,A,B,C,D;function E(a,b){for(var h=2*(a*d.width+b<<2)+1,f=0;2>f;f++)for(var u=0;2>u;u++)F[h+(f*d.width+u<<2)]=150}
var G,F,H={start:function(a){var b=new Date;H["time_start_"+a]=[b.getMinutes(),b.getSeconds(),b.getMilliseconds()]},stop:function(a){var b=new Date;H["time_end_"+a]=[b.getMinutes(),b.getSeconds(),b.getMilliseconds()]},get:function(a){var b=H["time_start_"+a];a=H["time_end_"+a];return a[0]-b[0]+(a[1]-b[1])+(a[2]-b[2])}};c("startStop").onclick=function(){"Start"==c("startStop").innerText?(I(),c("startStop").innerText="Stop"):(w&&(clearInterval(v),y=!0),c("startStop").innerText="Start")};
c("restart").onclick=function(){return J()};d.width=2*n;d.height=2*p;J();window.onkeydown=function(a){switch(a.keyCode){case 32:return"Start"==c("startStop").innerText?(I(),c("startStop").innerText="Stop"):(w&&(clearInterval(v),y=!0),c("startStop").innerText="Start"),!1}};
function I(){if(t)console.warn("Interval is stopped!");else{t=!0;H.start("interval");for(var a=0;a<p;a++){0==a?(z=!0,A=!1):(z=!1,A=a==r?!0:!1);for(var b=0;b<n;b++)if(0==b?(B=!0,C=!1):(B=!1,C=b==q?!0:!1),D=0,B?(D=A?D+k[r][q]:D+k[a+1][q],D+=k[a][q],z?(D+=k[r][b],D+=k[r][q]):(D+=k[a-1][q],D+=k[a-1][b])):(D=A?D+k[r][b-1]:D+k[a+1][b-1],D+=k[a][b-1],z?(D+=k[r][b],D+=k[r][b-1]):(D+=k[a-1][b-1],D+=k[a-1][b])),C?(A?(D+=k[0][b],D+=k[0][0]):(D+=k[a+1][0],D+=k[a+1][b]),D+=k[a][0],D=z?D+k[r][0]:D+k[a-1][0]):(A?
(D+=k[0][b],D+=k[0][b+1]):(D+=k[a+1][b],D+=k[a+1][b+1]),D+=k[a][b+1],D=z?D+k[r][b+1]:D+k[a-1][b+1]),3==D)l[a][b]=1;else if(2==D)l[a][b]=k[a][b];else if(l[a][b]=0,0!=k[a][b])for(var h=2*(a*d.width+b<<2)+1,f=0;2>f;f++)for(var u=0;2>u;u++)F[h+(f*d.width+u<<2)]=0}if(20<w||y){for(a=0;a<p;a++)for(b=0;b<n;b++)k[a][b]!=l[a][b]&&1==l[a][b]&&E(a,b),k[a][b]=l[a][b];y=!1;e.putImageData(G,0,0)}else if(!(m<<31>>>31)){for(a=0;a<p;a++)for(b=0;b<n;b++)k[a][b]!=l[a][b]&&1==l[a][b]&&E(a,b),k[a][b]=l[a][b];e.putImageData(G,
0,0)}H.stop("interval");x.push(H.get("interval"));0<x[x.length-1]&&(w=1.3*x[x.length-1]);a=+g.value;w<a&&(w=a);m%5||(c("intervalTime").innerHTML=w/1E3,c("time").innerHTML=x[x.length-1]/1E3,c("generation").innerHTML=m);m++;t=!1;clearInterval(v);v=setInterval(I,w)}}
function J(){var a=void 0===a?1:a;var b=void 0===b?6:b;n=c("width").value;p=c("height").value;q=n-1;r=p-1;c("generation").innerHTML=null;d.width=2*n;d.height=2*p;m=0;x=[];w=1E3;e.fillStyle="rgb(0,0,0)";e.fillRect(0,0,d.width,d.height);k=Array(p);l=Array(p);e.fillStyle="rgb(0,150,0)";for(var h=0;h<p;h++){k[h]=Array(n);l[h]=Array(n);for(var f=0;f<n;f++)Math.round(.5+Math.random()*b)<=a?(e.fillRect(2*f,2*h,2,2),k[h][f]=1):k[h][f]=0,l[h][f]=k[h][f]}G=e.getImageData(0,0,d.width,d.height);F=G.data}
function c(a){return document.getElementById(a)};